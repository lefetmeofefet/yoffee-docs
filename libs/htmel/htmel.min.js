var htmel=function(e){var t={};function s(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(exports,e,t){s.o(exports,e)||Object.defineProperty(exports,e,{enumerable:!0,get:t})},s.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(o,i,function(t){return e[t]}.bind(null,i));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t),s.d(t,"HTMElement",(function(){return i}));class o extends HTMLElement{constructor(e){super(),this.state=e||{},this.props={};const t=e=>{let t=void 0===this[e]?this.getAttribute(e):this[e];this.props[e]=""===t||t};[...this.attributes].forEach(e=>t(e.name));new MutationObserver(e=>e.forEach(e=>{t(e.attributeName),this.propUpdated&&this.propUpdated(e.attributeName)})).observe(this,{attributes:!0}),this.attachShadow({mode:"open"}),this._htmelFragment=this.render(),this.shadowRoot.appendChild(this._htmelFragment)}get html(){return R}disconnectedCallback(){this._htmelFragment.__removeWatchers()}}var i=o;const l=new Map;function n(e,t,s){let o=l.get(e);null==o?(o=[{onGet:t,onSet:s}],l.set(e,o),function(e,t,s){const o={},i=i=>{Object.defineProperty(e,i,{get:()=>(t&&t(i),o[i]),set(e){o[i]=e,s&&s(i,e)}})},l=Object.getOwnPropertyDescriptors(e);for(let t of Object.keys(l))"__notWatchedProp"!==t&&(o[t]=e[t],i(t));Object.setPrototypeOf(e,new Proxy(o,{get(t,s){i(s),Reflect.get(e,s)},set:(t,s,o)=>(i(s),e[s]=o,!0)}))}(e,t=>o.forEach(s=>s.onGet(t,e)),(t,s)=>o.forEach(o=>o.onSet(t,s,e)))):o.push({onGet:t,onSet:s})}const r="Text/CSS node",a="Attribute value",h="Attribute name",d="HTML tag";function u(e,t){const s=[{type:r,xpath:`.//text()[contains(., '${t}')]`},{type:a,xpath:`.//@*[contains(., '${t}')]`},{type:h,xpath:`.//@*[contains(name(), '${t}')]`},{type:d,xpath:`.//*[contains(name(), '${t}')]`}];for(let t of s){let s=document.evaluate(t.xpath,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=s)return{domNode:s,searchLocation:t.type}}}function c(e,t){for(let s of t)e=e.replace(s.id,"${"+s._cb.toString()+"}");return e}function p(){return new Array(4).fill(0).map(()=>Math.random().toString(36).substr(2,9)).join("-")}function m(e,t,s){let o=e.get(t);null!=o?o.push(s):e.set(t,[s])}class f{constructor(e,t,s){this.expressions=e,this.domNode=t,this.expressionsLocation=s,this._arrayDomNodes=[],this.initialValue={[r]:()=>t.data,[a]:()=>t.value,[h]:()=>t.name}[s](),this.ownerElement=this.domNode.ownerElement}update(){this.expressionsLocation===r?this._updateTextNodeValue():this.expressionsLocation===a?this._updateAttributeNodeValue():this.expressionsLocation===h&&this._updateAttributeNodeName()}_updateTextNodeValue(){let e=this.expressions[0];if(e.cached)return;let t=e.lastResult;if(null!=t&&!1!==t||(t=""),this._lastTextNodeValue instanceof Array&&!(t instanceof Array)){for(let e of this._arrayDomNodes)this._removeDomNode(e);this._arrayDomNodes=[]}if(t instanceof DocumentFragment&&(t=0===t.childNodes.length?"":1===t.childNodes.length?t.firstChild:[...t.childNodes]),t instanceof Array){if(!(this._lastTextNodeValue instanceof Array)){let e=document.createElement("htmel-list-location-marker");this.domNode.replaceWith(e),this.domNode=e}let e=[],s=null,o=e=>{null==s?this.domNode.parentNode.prepend(e):this.domNode.parentNode.insertBefore(e,s.nextSibling),s=e.__isHtmel?e.__childNodes[e.__childNodes.length-1]:e};for(let i of t){if(null==i)continue;let t=this._arrayDomNodes[0];if(null!=t&&(t instanceof Text?t.data:t)===("number"==typeof i?i.toString():i))e.push(t),s=t.__isHtmel?t.__childNodes[t.__childNodes.length-1]:t,this._arrayDomNodes.shift();else if(i="object"==typeof i?i:document.createTextNode(i),e.push(i),i.__isHtmel)for(let e of i.__childNodes)o(e);else o(i)}for(let t of this._arrayDomNodes)-1===e.indexOf(t)&&this._removeDomNode(t);this._arrayDomNodes=e}else if("object"==typeof t)this.domNode.replaceWith(t),this.domNode=t;else if("object"==typeof this._lastTextNodeValue){let e=document.createTextNode(t);this.domNode.replaceWith(e),this.domNode=e}else this.domNode.data!==t.toString()&&(this.domNode.data=t);this._lastTextNodeValue=t}_removeDomNode(e){if(e.__isHtmel)for(let t of e.__childNodes)t.remove();else e.remove()}_updateAttributeNodeValue(){if(this.expressions[0].isEventHandler){if(this.expressions.length>1){throw`HTMEL: Cant have more than one expression as event handler: ${c(this.initialValue,this.expressions)}`}this._setEventListener()}else{let e=this.expressions[0].lastResult,t=1===this.expressions.length&&this.initialValue.length===this.expressions[0].id.length;if(!t||!1!==e&&null!=e)if(t&&["function","object"].includes(typeof e))this.ownerElement[this.domNode.name]=e,this._setDomNode("__obj_placeholder__");else if(t&&!0===e)this.ownerElement[this.domNode.name]=void 0,this._setDomNode("");else{this.ownerElement[this.domNode.name]=void 0;let e=this.initialValue;for(let t of this.expressions)e=e.replace(t.id,t.lastResult);this._setDomNode(e)}else this.ownerElement[this.domNode.name]=void 0,this.ownerElement.removeAttribute(this.domNode.name)}}_setDomNode(e){this.domNode.value=e,null==this.domNode.ownerElement&&this.ownerElement.setAttributeNode(this.domNode)}_updateAttributeNodeName(){let e=this.expressions[0].lastResult,t=1===this.expressions.length&&this.initialValue.length===this.expressions[0].id.length;if(this._lastAttributeMap){for(let[e,t]of this._lastAttributeMap)this.ownerElement.removeAttribute(e),this.ownerElement[e]=void 0;this._lastAttributeMap=null}else this.ownerElement.removeAttribute(this.domNode.name);if(!t||!1!==e&&null!=e&&""!==e)if(t&&"object"==typeof e){this._lastAttributeMap=Object.entries(e);for(let[e,t]of this._lastAttributeMap)!1!==t&&null!==t&&(["function","object"].includes(typeof t)?(this.ownerElement.setAttribute(e,"__obj_placeholder__"),this.ownerElement[e]=t):(!0===t&&(t=""),this.ownerElement.setAttribute(e,t)))}else{let e=this.initialValue;for(let t of this.expressions)e=e.replace(t.id,t.lastResult);this.ownerElement.setAttribute(e,this.domNode.value),this.domNode=this.ownerElement.getAttributeNode(e)}}_setEventListener(){let e=this.domNode.name.substring(2);this.domNode.ownerElement.addEventListener(e,(...e)=>{const t=this.expressions[0].lastResult(...e);return"function"==typeof t?t(...e):t}),this.domNode.ownerElement.removeAttributeNode(this.domNode)}}function _(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}const b="primitive",N="array",x="htmel_template";class y{constructor(e){this._cb=e,this.id=p(),this.lastResult=null,this.boundNode=null,this.isEventHandler=!1,this.isStatic="function"!=typeof this._cb,this.resultType=null,this.resultMetadata=null}execute(){if(this.cached=!1,this.isEventHandler||this.isStatic)this.lastResult=this._cb;else{let e=this._cb();null!=e&&e.createHtmelTemplate?this.handleHtmelTemplate(e):Array.isArray(e)?this.handleArray(e):(this.removeChildTemplateListeners(),this.lastResult=e,this.resultType=b,this.resultMetadata=null)}}handleHtmelTemplate(e){var t,s,o,i;this.resultType===x&&null==this.resultMetadata.htmelTemplate||(this.resultType===x&&this.resultMetadata.cacheable&&(t=this.resultMetadata.hash,s=this.resultMetadata.propsObjs,o=e.hash,i=e.propsObjs,t===o&&_(s,i))?(this.cached=!0,this.lastResult.__expressions.forEach((t,s)=>{t._cb=e.expressionCbs[s]}),this.lastResult.__updateExpressions()):(this.removeChildTemplateListeners(),this.resultType=x,this.resultMetadata=e,this.lastResult=e.createHtmelTemplate()))}handleArray(e){if(this.resultType===N){let t=this.resultMetadata;this.lastResult=[];let s=new Map;this.resultMetadata=s;for(let o of e)if(null!=o&&o.createHtmelTemplate){let e=!1,i=t.get(o.hash);if(null!=i&&o.cacheable){let t=i.findIndex(e=>_(e.propsObjs,o.propsObjs));if(-1!==t){let l=i.splice(t,1)[0];e=!0,this.lastResult.push(l.htmelTemplate),l.shouldntDelete=!0,l.htmelTemplate.__expressions.forEach((e,t)=>{e._cb=o.expressionCbs[t]}),l.htmelTemplate.__updateExpressions(),m(s,l.hash,l)}}if(!e){m(s,o.hash,o);let e=o.createHtmelTemplate();this.lastResult.push(e)}}else this.lastResult.push(o);for(let e of t.values())e.forEach(e=>{e.shouldntDelete||e.htmelTemplate.__removeWatchers()});for(let e of s.values())e.forEach(e=>{e.shouldntDelete&&(e.shouldntDelete=void 0)})}else{this.removeChildTemplateListeners(),this.lastResult=[];let t=new Map;for(let s of e)if(null!=s&&s.createHtmelTemplate){let e=s.createHtmelTemplate();this.lastResult.push(e),m(t,s.hash,s)}else this.lastResult.push(s);this.resultMetadata=t}this.resultType=N}removeChildTemplateListeners(){null!=this.resultType&&(this.resultType===x?this.resultMetadata.htmelTemplate.__removeWatchers():this.resultType===N&&this.lastResult.filter(e=>e.__isHtmel).forEach(e=>e.__removeWatchers()))}}function g(e,t){let s=e.data.trim(),o=s.indexOf(t),i=o+t.length;return 0!==o&&e.parentNode.insertBefore(document.createTextNode(s.substring(0,o)),e),i<s.length&&e.parentNode.insertBefore(document.createTextNode(s.substring(i)),e.nextSibling),e.data=s.substring(o,i),e}function v(e,t){return t.reduce((t,s,o)=>t+s+e[o+1],e[0]).split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)}let E=new Map,T=null,w=!1,M=new Set,A=null,j=(e,t)=>{if(!w)return;let s=`${t.__notWatchedProp}.${e}`;M.has(s)||(M.add(s),A.boundProps.add(s),E.has(s)||E.set(s,new Set),E.get(s).add(A))},S=(e,t,s)=>{if(w)throw`HTMEL: Setting properties is not allowed inside an expression! (${e} = ${t})`;let o=`${s.__notWatchedProp}.${e}`,i=T;T=o;let l=E.get(T);null!=l&&(H([...l],!0),T=i)};const H=(e,t)=>{let s=w;w=!0;try{for(let s of e){s.boundProps.forEach(e=>E.get(e).delete(s));let e=new Set(M);t?M=new Set(s.__propsAccessedByFather||[]):s.__propsAccessedByFather=new Set(M);let o=A;A=s,s.execute(),A=o,M=e}}finally{w=s}for(let t of new Set(e.map(e=>e.boundNode)))t.update()};function O(e,t,s){let o=document.createDocumentFragment();o.__isHtmel=!0;const i=s.map(e=>new y(e));i.forEach(e=>e.boundProps=new Set);const l=function(e){let t=document.createElement("template");t.innerHTML=`<htmel-template-container>${e.trim()}</htmel-template-container>`;let s=t.content.firstElementChild;return navigator.userAgent.toLowerCase().indexOf("firefox")>-1?document.adoptNode(s):s}((n=t,i.map(e=>e.id).reduce((e,t,s)=>e+t+n[s+1],n[0])));var n;return function(e,t){const s=new Map;for(let o of t){let t=null;if(t=u(e,o.id),null==t)throw`HTMEL: Expression location is not valid: ${"${"+o._cb.toString()+"}"}`;let{domNode:i,searchLocation:l}=t;if(l===r&&(i=g(i,o.id)),l===d){throw`HTMEL: Calculating element name is not allowed: ${c(`<${i.localName}>`,[o])}`}if(l===a&&i.name.startsWith("on")&&(o.isEventHandler=!0),s.has(i)){let e=s.get(i);e.expressions.push(o),o.boundNode=e}else{let e=new f([o],i,l);s.set(i,e),o.boundNode=e}}}(l,i),o.__removeWatchers=()=>{for(let e of i)e.boundProps.forEach(t=>E.get(t).delete(e)),e.removeChildTemplateListeners()},H(i),o.__childNodes=[...l.childNodes],o.__expressions=i,o.__updateExpressions=()=>H(i.filter(e=>!e.isStatic)),o.append(...l.childNodes),o}var R=t.default=function(...e){return e.forEach(e=>{if("object"!=typeof e)throw`HTMEL: Props object must be an object, got ${typeof propsObject}`;if(null==e)throw"HTMEL: Props object can't be null";null==e.__notWatchedProp&&(e.__notWatchedProp=p(),n(e,j,S))}),(t,...s)=>{let o=()=>O(0,t,s);if(w){let i={propsObjs:e,expressionCbs:s,hash:v(t,s),cacheable:!1};return i.createHtmelTemplate=()=>{let e=o();return i.htmelTemplate=e,e},i}return o()}}}]);export default htmel.default; let HTMElement = htmel.HTMElement; export {HTMElement}
